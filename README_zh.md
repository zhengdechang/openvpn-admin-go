[English Documentation](./README.md)

# OpenVPN Admin Go

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ OpenVPN ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨ Go åç«¯å’Œ Next.js å‰ç«¯æ„å»ºã€‚æœ¬é¡¹ç›®ä¸ºç®¡ç† OpenVPN æœåŠ¡å™¨ã€ç”¨æˆ·ã€è¯ä¹¦å’Œè¿æ¥ç›‘æ§æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ç›´è§‚çš„ Web ç•Œé¢è¿›è¡Œæ“ä½œã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒç®¡ç†åŠŸèƒ½

- **ğŸ” ç”¨æˆ·è®¤è¯ä¸æˆæƒï¼š** å¤šè§’è‰²ç”¨æˆ·ç³»ç»Ÿï¼ˆè¶…çº§ç®¡ç†å‘˜ã€ç®¡ç†å‘˜ã€ç»ç†ã€ç”¨æˆ·ï¼‰ï¼ŒåŸºäº JWT çš„èº«ä»½éªŒè¯
- **ğŸ¢ éƒ¨é—¨ç®¡ç†ï¼š** å±‚æ¬¡åŒ–ç»„ç»‡ç»“æ„ï¼Œä¾¿äºç”¨æˆ·ç®¡ç†å’Œè®¿é—®æ§åˆ¶
- **âš™ï¸ OpenVPN æœåŠ¡å™¨ç®¡ç†ï¼š** å®Œæ•´çš„æœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œé…ç½®æ›´æ–°
- **ğŸ‘¥ å®¢æˆ·ç«¯ç®¡ç†ï¼š** è‡ªåŠ¨åŒ–å®¢æˆ·ç«¯è¯ä¹¦ç”Ÿæˆã€é…ç½®æ–‡ä»¶åˆ›å»ºå’Œè®¿é—®æ§åˆ¶
- **ğŸ“Š å®æ—¶ç›‘æ§ï¼š** å®æ—¶è¿æ¥çŠ¶æ€ã€æµé‡ç›‘æ§å’Œä¼šè¯è·Ÿè¸ª
- **ğŸ“ å…¨é¢æ—¥å¿—è®°å½•ï¼š** æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¥å¿—è®¿é—®ï¼Œæ”¯æŒå®æ—¶æ›´æ–°

### é«˜çº§åŠŸèƒ½

- **ğŸŒ å›ºå®š IP åˆ†é…ï¼š** ä¸ºç‰¹å®šå®¢æˆ·ç«¯åˆ†é…é™æ€ IP åœ°å€
- **ğŸ”’ å®¢æˆ·ç«¯è®¿é—®æ§åˆ¶ï¼š** æš‚åœ/æ¢å¤å®¢æˆ·ç«¯è®¿é—®ï¼Œæ— éœ€æ’¤é”€è¯ä¹¦
- **ğŸ“‹ è¯ä¹¦ç®¡ç†ï¼š** è‡ªåŠ¨åŒ–è¯ä¹¦ç”Ÿæˆã€ç»­æœŸå’Œæ’¤é”€
- **ğŸ”„ å®æ—¶åŒæ­¥ï¼š** OpenVPN çŠ¶æ€ä¸æ•°æ®åº“çš„è‡ªåŠ¨åŒæ­¥
- **ğŸ¯ å­ç½‘ç®¡ç†ï¼š** é…ç½®å®¢æˆ·ç«¯ç‰¹å®šçš„å­ç½‘è·¯ç”±
- **ğŸ“ˆ ä½¿ç”¨åˆ†æï¼š** è·Ÿè¸ªè¿æ¥æ—¶é•¿ã€æ•°æ®ä¼ è¾“å’Œä½¿ç”¨æ¨¡å¼

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

æœ¬é¡¹ç›®ç”±ä¸¤ä¸ªä¸»è¦ç»„ä»¶æ„æˆï¼š

### åç«¯ (openvpn-admin-go)

- **å¼€å‘è¯­è¨€ï¼š** Go 1.21+
- **Web æ¡†æ¶ï¼š** Gin (HTTP è·¯ç”±å™¨)
- **æ•°æ®åº“ï¼š** SQLite é…åˆ GORM ORM
- **èº«ä»½éªŒè¯ï¼š** JWT ä»¤ç‰Œ
- **OpenVPN é›†æˆï¼š** ç›´æ¥ä¸ OpenVPN æœåŠ¡ç³»ç»Ÿé›†æˆ

### å‰ç«¯ (openvpn-web)

- **å¼€å‘æ¡†æ¶ï¼š** Next.js 14 é…åˆ TypeScript
- **UI åº“ï¼š** Tailwind CSS + Radix UI ç»„ä»¶
- **çŠ¶æ€ç®¡ç†ï¼š** Zustand
- **å›½é™…åŒ–ï¼š** i18next
- **API å®¢æˆ·ç«¯ï¼š** Axios

## ğŸ–¥ï¸ ç®¡ç†ç•Œé¢

### 1. äº¤äº’å¼ CLI èœå•

åº”ç”¨ç¨‹åºæä¾›ç›´è§‚çš„å‘½ä»¤è¡Œç•Œé¢å’Œäº¤äº’å¼èœå•ï¼š

```bash
# å¯åŠ¨äº¤äº’å¼ CLI
go run main.go

# æˆ–ä½¿ç”¨ç‰¹å®šå‘½ä»¤
go run cmd/main.go --help
```

#### ç›´æ¥è¿è¡Œç¼–è¯‘åçš„äºŒè¿›åˆ¶ï¼ˆæ—  Dockerï¼‰

```bash
# ç¼–è¯‘äºŒè¿›åˆ¶
go build -o bin/openvpn-go .

# å¯åŠ¨äº¤äº’å¼èœå•
./bin/openvpn-go

# ï¼ˆå¯é€‰ï¼‰ä½¿ç”¨åŒä¸€ä¸ªäºŒè¿›åˆ¶å¯åŠ¨ Web/API æœåŠ¡
# å¯åœ¨å¦ä¸€ç»ˆç«¯æˆ–åå°è¿è¡Œï¼Œä¿è¯èœå•ä¿æŒå¯ç”¨
./bin/openvpn-go web --port 8085
```

**å¯ç”¨çš„ CLI æ“ä½œï¼š**

- æœåŠ¡å™¨ç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢/é‡å¯/é…ç½®ï¼‰
- å®¢æˆ·ç«¯ç®¡ç†ï¼ˆåˆ›å»º/åˆ é™¤/æš‚åœ/æ¢å¤ï¼‰
- Web æœåŠ¡ç®¡ç†
- é…ç½®æŸ¥çœ‹
- æ—¥å¿—ç›‘æ§

### 2. Web ä»ªè¡¨æ¿

ç°ä»£åŒ–çš„ Web ç•Œé¢ï¼Œé»˜è®¤è®¿é—®åœ°å€ï¼š`http://localhost:8085`

**ä¸»è¦ç‰¹æ€§ï¼š**

- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- å®æ—¶è¿æ¥ç›‘æ§
- æ‹–æ‹½å¼è¯ä¹¦ç®¡ç†
- å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

## ğŸ“¦ å®‰è£…å’Œè®¾ç½®

### ç³»ç»Ÿè¦æ±‚

- **Go 1.21+** - åç«¯å¼€å‘
- **Node.js 18+** - å‰ç«¯å¼€å‘
- **OpenVPN** - VPN æœåŠ¡å™¨è½¯ä»¶
- **Linux ç³»ç»Ÿ** - Ubuntu/Debian/CentOSï¼ˆéœ€è¦ systemdï¼‰
- **Root/Sudo æƒé™** - ç”¨äº OpenVPN æœåŠ¡ç®¡ç†

### å¿«é€Ÿå¼€å§‹

1. **å…‹éš†ä»“åº“ï¼š**

   ```bash
   git clone <your-repository-url>
   cd openvpn-admin-go
   ```

2. **åç«¯è®¾ç½®ï¼š**

   ```bash
   # å®‰è£… Go ä¾èµ–
   go mod tidy

   # åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶è¿›è¡Œé…ç½®

   # è¿è¡Œåº”ç”¨ç¨‹åºï¼ˆä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–ï¼‰
   go run main.go
   ```

3. **å‰ç«¯è®¾ç½®ï¼š**

   ```bash
   cd openvpn-web

   # å®‰è£… Node.js ä¾èµ–
   npm install

   # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
   npm run dev
   ```

4. **è®¿é—®åº”ç”¨ç¨‹åºï¼š**
   - **CLI ç•Œé¢ï¼š** è¿è¡Œ `go run main.go` è¿›å…¥äº¤äº’å¼èœå•
   - **Web ç•Œé¢ï¼š** æ‰“å¼€ `http://localhost:3000`ï¼ˆå‰ç«¯ï¼‰æˆ– `http://localhost:8085`ï¼ˆåç«¯ APIï¼‰
   - **é»˜è®¤ç™»å½•ï¼š** `superadmin@gmail.com` / `superadmin`

### ç¯å¢ƒé…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®
DB_PATH=data/db.sqlite3

# JWT é…ç½®
JWT_SECRET=your-super-secret-jwt-key

# OpenVPN é…ç½®
OPENVPN_SERVER_HOSTNAME=your-server-ip-or-domain
OPENVPN_PORT=1194
OPENVPN_PROTO=udp
OPENVPN_SERVER_NETWORK=10.8.0.0
OPENVPN_SERVER_NETMASK=255.255.255.0
OPENVPN_CLIENT_CONFIG_DIR=/etc/openvpn/clients
OPENVPN_STATUS_LOG_PATH=/var/log/openvpn/status.log
OPENVPN_LOG_PATH=/var/log/openvpn/openvpn.log

# å¯é€‰ï¼šLevelDB é¢å¤–å­˜å‚¨
LEVELDB_PATH=/var/lib/openvpn-manager
```

## ğŸ“ é¡¹ç›®ç»“æ„

### åç«¯ç»“æ„

```
openvpn-admin-go/
â”œâ”€â”€ cmd/                    # CLI å‘½ä»¤å’Œå…¥å£ç‚¹
â”‚   â”œâ”€â”€ main.go            # ä¸» CLI ç•Œé¢å’Œäº¤äº’å¼èœå•
â”‚   â”œâ”€â”€ server.go          # æœåŠ¡å™¨ç®¡ç†å‘½ä»¤
â”‚   â”œâ”€â”€ client.go          # å®¢æˆ·ç«¯ç®¡ç†å‘½ä»¤
â”‚   â”œâ”€â”€ web.go             # Web æœåŠ¡ç®¡ç†
â”‚   â””â”€â”€ environment.go     # ç¯å¢ƒè®¾ç½®å’ŒéªŒè¯
â”œâ”€â”€ controller/            # HTTP è¯·æ±‚å¤„ç†å™¨
â”‚   â”œâ”€â”€ auth.go           # èº«ä»½éªŒè¯ç«¯ç‚¹
â”‚   â”œâ”€â”€ client.go         # å®¢æˆ·ç«¯ç®¡ç† API
â”‚   â”œâ”€â”€ server.go         # æœåŠ¡å™¨ç®¡ç† API
â”‚   â”œâ”€â”€ department.go     # éƒ¨é—¨ç®¡ç† API
â”‚   â””â”€â”€ log.go            # æ—¥å¿—è®¿é—® API
â”œâ”€â”€ model/                # æ•°æ®æ¨¡å‹å’Œæ•°æ®åº“æ¶æ„
â”‚   â”œâ”€â”€ client.go         # ç”¨æˆ·å’Œå®¢æˆ·ç«¯æ¨¡å‹
â”‚   â”œâ”€â”€ department.go     # éƒ¨é—¨æ¨¡å‹
â”‚   â”œâ”€â”€ server.go         # æœåŠ¡å™¨é…ç½®æ¨¡å‹
â”‚   â””â”€â”€ status.go         # è¿æ¥çŠ¶æ€å’Œæ—¥å¿—æ¨¡å‹
â”œâ”€â”€ openvpn/              # OpenVPN é›†æˆå±‚
â”‚   â”œâ”€â”€ config.go         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ server.go         # æœåŠ¡å™¨æ“ä½œ
â”‚   â”œâ”€â”€ client.go         # å®¢æˆ·ç«¯è¯ä¹¦å’Œé…ç½®ç”Ÿæˆ
â”‚   â”œâ”€â”€ status_parser.go  # çŠ¶æ€æ—¥å¿—è§£æ
â”‚   â””â”€â”€ ccd.go            # å®¢æˆ·ç«¯ç‰¹å®šé…ç½®
â”œâ”€â”€ router/               # API è·¯ç”±å®šä¹‰
â”œâ”€â”€ middleware/           # HTTP ä¸­é—´ä»¶ï¼ˆJWTã€RBACï¼‰
â”œâ”€â”€ database/             # æ•°æ®åº“è¿æ¥å’Œè¿ç§»
â”œâ”€â”€ services/             # åå°æœåŠ¡ï¼ˆåŒæ­¥ã€ç›‘æ§ï¼‰
â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”œâ”€â”€ constants/            # åº”ç”¨ç¨‹åºå¸¸é‡
â”œâ”€â”€ template/             # OpenVPN é…ç½®æ¨¡æ¿
â””â”€â”€ main.go              # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
```

### å‰ç«¯ç»“æ„

```
openvpn-web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/              # Next.js App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ dashboard/    # ä¸»åº”ç”¨ç¨‹åºä»ªè¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ auth/         # èº«ä»½éªŒè¯é¡µé¢
â”‚   â”‚   â””â”€â”€ page.tsx      # é¦–é¡µ
â”‚   â”œâ”€â”€ components/       # å¯é‡ç”¨çš„ React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/           # åŸºç¡€ UI ç»„ä»¶ï¼ˆæŒ‰é’®ã€è¾“å…¥ç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ layout/       # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ services/         # API å®¢æˆ·ç«¯å’ŒæœåŠ¡å‡½æ•°
â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ lib/              # å·¥å…·åº“å’Œé…ç½®
â”‚   â””â”€â”€ i18n/             # å›½é™…åŒ–æ–‡ä»¶
â”œâ”€â”€ public/               # é™æ€èµ„æº
â””â”€â”€ package.json          # ä¾èµ–å’Œè„šæœ¬
```

## ğŸ”Œ API ç«¯ç‚¹

RESTful API æä¾›å…¨é¢çš„ç®¡ç†åŠŸèƒ½ï¼š

### èº«ä»½éªŒè¯å’Œç”¨æˆ·ç®¡ç†

- `POST /api/user/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/user/login` - ç”¨æˆ·èº«ä»½éªŒè¯
- `GET /api/user/me` - è·å–å½“å‰ç”¨æˆ·èµ„æ–™
- `PATCH /api/user/me` - æ›´æ–°ç”¨æˆ·èµ„æ–™
- `POST /api/user/logout` - ç”¨æˆ·ç™»å‡º
- `GET /api/user/refresh` - åˆ·æ–° JWT ä»¤ç‰Œ

### å®¢æˆ·ç«¯ç®¡ç†

- `GET /api/client` - åˆ—å‡ºæ‰€æœ‰å®¢æˆ·ç«¯/ç”¨æˆ·
- `POST /api/client` - åˆ›å»ºæ–°å®¢æˆ·ç«¯
- `GET /api/client/:id` - è·å–å®¢æˆ·ç«¯è¯¦æƒ…
- `PUT /api/client/:id` - æ›´æ–°å®¢æˆ·ç«¯
- `DELETE /api/client/:id` - åˆ é™¤å®¢æˆ·ç«¯
- `GET /api/client/config/:username` - ä¸‹è½½å®¢æˆ·ç«¯é…ç½®
- `POST /api/client/:username/pause` - æš‚åœå®¢æˆ·ç«¯è®¿é—®
- `POST /api/client/:username/resume` - æ¢å¤å®¢æˆ·ç«¯è®¿é—®

### æœåŠ¡å™¨ç®¡ç†

- `GET /api/server/status` - è·å–æœåŠ¡å™¨çŠ¶æ€
- `POST /api/server/start` - å¯åŠ¨ OpenVPN æœåŠ¡å™¨
- `POST /api/server/stop` - åœæ­¢ OpenVPN æœåŠ¡å™¨
- `POST /api/server/restart` - é‡å¯ OpenVPN æœåŠ¡å™¨
- `PUT /api/server/update` - æ›´æ–°æœåŠ¡å™¨é…ç½®

### éƒ¨é—¨ç®¡ç†

- `GET /api/departments` - åˆ—å‡ºéƒ¨é—¨
- `POST /api/departments` - åˆ›å»ºéƒ¨é—¨
- `PUT /api/departments/:id` - æ›´æ–°éƒ¨é—¨
- `DELETE /api/departments/:id` - åˆ é™¤éƒ¨é—¨

### ç›‘æ§å’Œæ—¥å¿—

- `GET /api/logs/server` - è·å–æœåŠ¡å™¨æ—¥å¿—
- `GET /api/logs/client` - è·å–å®¢æˆ·ç«¯æ—¥å¿—
- `GET /api/client/status/live` - è·å–å®æ—¶è¿æ¥çŠ¶æ€

## ğŸ” ç”¨æˆ·è§’è‰²å’Œæƒé™

| è§’è‰²           | æƒé™                                   |
| -------------- | -------------------------------------- |
| **è¶…çº§ç®¡ç†å‘˜** | å®Œæ•´ç³»ç»Ÿè®¿é—®æƒé™ï¼Œç”¨æˆ·ç®¡ç†ï¼ŒæœåŠ¡å™¨é…ç½® |
| **ç®¡ç†å‘˜**     | ç”¨æˆ·ç®¡ç†ï¼Œéƒ¨é—¨ç®¡ç†ï¼Œå®¢æˆ·ç«¯æ“ä½œ         |
| **ç»ç†**       | æŒ‡å®šéƒ¨é—¨å†…çš„å®¢æˆ·ç«¯ç®¡ç†                 |
| **ç”¨æˆ·**       | æŸ¥çœ‹ä¸ªäººèµ„æ–™ï¼Œä¸‹è½½ä¸ªäºº VPN é…ç½®        |

## ğŸš€ éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **æ„å»ºåº”ç”¨ç¨‹åºï¼š**

   ```bash
   # åç«¯
   go build -o openvpn-admin main.go

   # å‰ç«¯
   cd openvpn-web
   npm run build
   ```

2. **é…ç½® systemd æœåŠ¡ï¼š**

   ```bash
   sudo cp openvpn-admin /usr/local/bin/
   sudo systemctl enable openvpn-admin
   sudo systemctl start openvpn-admin
   ```

3. **è®¾ç½®åå‘ä»£ç†ï¼ˆnginxï¼‰ï¼š**

   ```nginx
   server {
       listen 80;
       server_name your-domain.com;

       location /api/ {
           proxy_pass http://localhost:8085;
       }

       location / {
           proxy_pass http://localhost:3000;
       }
   }
   ```

### Docker éƒ¨ç½²

```bash
# ä½¿ç”¨ Docker Compose æ„å»ºå’Œè¿è¡Œ
docker-compose up -d
```

## ğŸ› ï¸ å¼€å‘

### åç«¯å¼€å‘

```bash
# çƒ­é‡è½½è¿è¡Œ
go run main.go

# è¿è¡Œæµ‹è¯•
go test ./...

# æ ¼å¼åŒ–ä»£ç 
go fmt ./...
```

### å‰ç«¯å¼€å‘

```bash
cd openvpn-web

# å¼€å‘æœåŠ¡å™¨
npm run dev

# ç±»å‹æ£€æŸ¥
npm run type-check

# ä»£ç æ£€æŸ¥
npm run lint
```

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“å¼€ Pull Request

## ğŸ“ æ”¯æŒ

å¦‚éœ€æ”¯æŒå’Œé—®é¢˜å’¨è¯¢ï¼š

- åœ¨ GitHub ä¸Šåˆ›å»º issue
- æŸ¥çœ‹ `docs/` ç›®å½•ä¸­çš„æ–‡æ¡£
- æŸ¥çœ‹ `examples/` ç›®å½•ä¸­çš„ç¤ºä¾‹é…ç½®
